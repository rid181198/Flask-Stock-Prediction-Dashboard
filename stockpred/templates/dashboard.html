{% extends 'base.html' %}
{% block title %}
    Dashboard page
{% endblock %}

{% block content %}


<body>
<div class="d-flex flex-column">
  <div class="d-grid">
    <div class="d-grid my-2">
      <div class="container mt-2 mb-2 mx-10 p-3 border border-dark font-weight-bolder text-center shadow" id="title-home">
        <p  class="text-center" style="font-size:1.4rem">Please click on SETTINGS and set the necessary parameters to get the specific Stocks and predictions.</p>
      </div>
      <button class="btn btn-light btn-outline-dark shadow mb-4" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions"><h2>SETTINGS</h2></button>
    </div>
    <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
      <div class="offcanvas-header" style="background-color: rgb(219, 217, 217)">
        <h3 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Settings</h3>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body" style="background-color: rgb(245, 245, 245);">
        <div class="d-flex flex-column mx-auto">
          <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.3rem">
            <a href="#" class="text-center" type="button" style="font-size:1.1rem; color:black" data-bs-toggle="modal" data-bs-target="#termsModal">Click here to understand the meta data of Settings</a>
          </div>
          <div class="d-flex justify-content-center">
            <form method="POST" class="form-register mt-5" style="color:black">
              {{form0.hidden_tag()}}
    
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
               {{ form0.code.label(id="form0label") }}
              </div>
              {{ form0.code(class = "form-control", id='code', onkeypress="startLoadingField(event)") }}
            </form>
          </div>
          <hr>
          <div class="d-flex justify-content-center">
            <form method="POST" class="form-register mt-5" style="color:black">
              {{form3.hidden_tag()}}
                <h5 class="text-black text-center my-2">Cancel the models</h5>
        
              <div class="d-grid text-center">
                  <div>
                    {{ form3.cancelmodel(class='btn btn-outline-dark btn-light', id="form3btn1", onclick="startLoading()") }}
                  </div>
                  <div class="mt-2">
                    {{ form3.cancellongmodel(class='btn btn-outline-dark btn-light', id="form3btn2", onclick="startLoading()") }}
                  </div>
              </div>
            </form>
          </div>
          <hr>
          <div class="d-flex justify-content-center">
            <form method="POST" class="form-register mt-5" style="color:black">
              {{form4.hidden_tag()}}
    
              <h5 class="text-black text-center mt-5 mb-4">Long prediction</h5>
              
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form4.numdays.label() }}
              </div>
              {{ form4.numdays(class='form-control', placeholder='e.g. 10') }}
    
              <div class="text-center mt-4">
                {{ form4.longprediction(class='btn btn-outline-dark btn-light', onclick="startLoading()") }}
              </div>
            </form>
          </div>
          <hr>
          <div class="d-flex justify-content-center">
            <form method="POST" class="form-register mt-5" style="color:black">
              {{form1.hidden_tag()}}
    
              <h4 class="text-black text-center mt-5 mb-4">Change the model</h4>
    
              <br>
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form1.newNeuron.label() }}
              </div>
              {{ form1.newNeuron(class="form-control", placeholder="e.g. 8")}}
              
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form1.newEpoch.label() }}
              </div>
              {{ form1.newEpoch(class="form-control", placeholder="e.g. 30")}}
              
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form1.newLookback.label() }}
              </div>
              {{ form1.newLookback(class="form-control", placeholder="e.g. 6")}}
              
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form1.newLoss.label() }}
              </div>
              {{ form1.newLoss(class="form-control", placeholder="Select an option")}}
    
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form1.newOptimizer.label() }}
              </div>
              {{ form1.newOptimizer(class="form-control", placeholder="Select an option")}}
    
              <br>
    
              <div class="text-center">
                <div>
                {{ form1.submitmodel(class='btn btn-md-md btn-outline-dark btn-light', onclick="startLoading()") }}
                </div>
                <div class="mt-2">
                  {{ form1.submitsave(class='btn btn-outline-dark btn-light', onclick="startLoading()") }}
                </div>
              </div>
            </form>
          </div>
          <hr>
          <div class="d-flex justify-content-center">
            <form method="POST" class="form-register mt-5" style="color:black">
              {{form2.hidden_tag()}}
    
              <h4 class="text-black text-center mt-5 mb-4">Change the long prediction model</h4>
    
              <br>
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form2.newNeuron.label() }}
              </div>
              {{ form2.newNeuron(class="form-control", placeholder="e.g. 8")}}
    
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form2.newEpoch.label() }}
              </div>
              {{ form2.newEpoch(class="form-control", placeholder="e.g. 30")}}
    
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form2.newLookback.label() }}
              </div>
              {{ form2.newLookback(class="form-control", placeholder="e.g. 6")}}
    
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form2.newLoss.label() }}
              </div>
              {{ form2.newLoss(class="form-control", placeholder="Select an option")}}
    
              <div class="container mt-4 mb-1 mx-10 p-1 border border-dark font-weight-bolder text-center shadow" style="font-size:1.2rem">
                {{ form2.newOptimizer.label() }}
              </div>
              {{ form2.newOptimizer(class="form-control", placeholder="Select an option")}}
    
              <br>
    
              <div class="text-center mb-5">
                <div>
                {{ form2.submitmodel(class='btn btn-md-md btn-outline-dark btn-light', onclick="startLoading()") }}
                </div>
                <div class="mt-2">
                  {{ form2.submitsave(class='btn btn-outline-dark btn-light', onclick="startLoading()") }}
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>  
  </div> 
  <div class="d-grid">
    <div id="chart" class="chart"></div>
  </div>

  <div class="d-felx flex-column mt-4">
    <div class="d-flex d-inline flex-row justify-content-center">
      <div class="container mb-2 p-2 border border-dark font-weight-bolder text-center shadow" id="errors" style="font-size:1.5rem">
        Default model's global RMSE : <strong>{{ errorsDict['globalerror'] }}</strong>
      </div>
       
      <div class="container mb-2 p-2 border border-dark font-weight-bolder text-center shadow" id="errors" style="font-size:1.5rem">
        Default model's current RMSE : <strong>{{ errorsDict['modelerror'] }}</strong>
      </div>
  
    </div>

    <div class="d-flex d-inline justify-content-center mt-3">
      <div class="container mb-2 p-2 border border-dark font-weight-bolder text-center shadow" id="errors" style="font-size:1.5rem">
        Your model's current RMSE : <strong>{{ errorsDict['newerror'] }}</strong>
      </div>
    </div>

  </div>
</div> 

</body>
 
{% include 'includes/items_modals.html' %}

<script type="text/javascript">
  var graphs = {{graphJSON | safe}};
  var container = document.getElementById('chart');
  Plotly.plot('chart', graphs, {});

  function resizePlot() {
    var layout = {
      width: window.innerWidth * 0.999, // Adjust the scaling factor as needed
      height: window.innerHeight * 0.8, // Adjust the scaling factor as needed
      legend: { font: { size: window.innerWidth * 0.02 } },
    yaxis: {
      title: 'Stock price',
      tickfont: {
      size: window.innerWidth * 0.018 // Change the font size as needed
      },
      titlefont: { size: window.innerWidth * 0.018 },
      showgrid: false,
      showticklabels: true,
      showline: true,
      showtickmode: "linear"
      
    },
    xaxis: {
      title: 'Date',
      tickfont: {
      size: window.innerWidth * 0.018 // Change the font size as needed
      },
      titlefont: { size: window.innerWidth * 0.018 },
      showgrid: false,
      showticklabels: true,
      showline: true,
      showtickmode: "linear"
    },
    title: {
      text: 'Real time stock prediction of {{ code }}',
      font: { size: window.innerWidth * 0.028 },
      xref: 'paper',
      x: 0.5,
      yref:'paper',
      y:0.995,
    },
    plot_bgcolor: 'rgb(245, 245, 245)', 
    paper_bgcolor: 'rgb(245, 245, 245)'
    };

    if (window.innerWidth <= 800) {
    layout.legend = {
      font: { size: window.innerWidth * 0.018 },
      orientation: 'h',
      yanchor: 'top',
      xanchor: 'center',
      x: 0.5,
      y: 1.28
    };
    } else {
      layout.legend = {
        font: { size: window.innerWidth * 0.018 },
      };
    }

    Plotly.relayout(container, layout);
  }

  // Call resizePlot() on load and add a listener for the 'resize' event
  resizePlot();
  window.addEventListener('resize', function() {
    window.requestAnimationFrame(resizePlot);
  });
</script>


{% endblock %}
    